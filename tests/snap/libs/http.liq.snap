># Set of HTTP utils.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
># Prepare a list of data to be sent as multipart form data.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~boundary Specify boundary to use for multipart/form-data.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param data data to insert
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.multipart_form_data(~boundary=null(), data)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap
#                                               ^^^^ source.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap
>  def default_boundary()
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap
>    range = [...string.char.ascii.alphabet, ...string.char.ascii.number]
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^^ source.liquidsoap
#             ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                ^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap keyword.other.liquidsoap
#                       ^^^^ source.liquidsoap variable.method.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap
#                            ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^ source.liquidsoap
#                                            ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                                               ^^^^^^ source.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap keyword.other.liquidsoap
#                                                      ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                          ^ source.liquidsoap keyword.other.liquidsoap
#                                                           ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                                ^ source.liquidsoap keyword.other.liquidsoap
#                                                                 ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                                       ^^ source.liquidsoap
>    l = list.init(12, fun(_) -> string.char.ascii.random(range))
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                            ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
>    string.concat(l)
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>  boundary = null.default(boundary, default_boundary)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
>  def mk_content(contents, entry) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
>    data = entry.contents
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap
#                 ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
>
>    attributes = [("name", entry.name), ...entry.attributes]
#^^^^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^^^ source.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap keyword.other.liquidsoap
#                                 ^^^^ source.liquidsoap variable.method.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap
#                                        ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                                           ^^^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap keyword.other.liquidsoap
#                                                 ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                           ^^ source.liquidsoap
>    attributes = list.map(fun (v) -> "#{string(fst(v))}=#{string.quote(snd(v))}", attributes)
#^^^^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                               ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                       ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                  ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap
>    attributes = string.concat(separator="; ", attributes)
#^^^^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
>
>    headers = list.map(fun (v) -> "#{string(fst(v))}: #{string(snd(v))}", entry.headers)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                            ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>    headers = string.concat(separator="\r\n", headers)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>    headers = headers == "" ? "" : "#{headers}\r\n"
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap keyword.control.liquidsoap
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap keyword.control.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                      ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                  ^ source.liquidsoap string.quoted.double.liquidsoap
>
>    # This is for typing purposes
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    (entry:unit)
#^^^^^ source.liquidsoap
#     ^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#           ^^^^ source.liquidsoap meta.type-annotation.liquidsoap storage.type.ground.liquidsoap
#               ^ source.liquidsoap meta.type-annotation.liquidsoap
>
>    [
#^^^^^^ source.liquidsoap
>      ...contents,
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      getter("--#{boundary}\r\n"),
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      getter("Content-Disposition: form-data; #{attributes}\r\n"),
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                           ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      getter(headers),
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      getter("\r\n"),
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      data,
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      getter("\r\n")
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
>    ]
#^^^^^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  contents = [
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^^^ source.liquidsoap
>    ...list.fold(mk_content, [], data),
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    getter("--#{boundary}--\r\n")
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>  ]
#^^^^ source.liquidsoap
>
>  contents = string.getter.concat(contents)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>  contents =
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
>    if list.for_all(fun (entry) -> getter.is_constant(entry.contents), data) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                            ^ source.liquidsoap
#                                                                             ^^^^ source.liquidsoap keyword.control.liquidsoap
>      getter(string.getter.flush(contents))
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      contents
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  { contents = contents, boundary = boundary }
#^^ source.liquidsoap
#  ^ source.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap
#                         ^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                                 ^^ source.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Initiate a response handler with pre-filled values.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method content_type Set `"Content-Type"` header
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method data Set response data.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method headers Replace response headers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method header Set a single header on the response
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method json Set content-type to json and data to `json.stringify` of the argument
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method redirect Set `status_code` and `Location:` header for a HTTP redirect response
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method html Set content-type to html and data to argument value
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method http_version Set http protocol version
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method status_code Set response status code
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method status_message Set response status message
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.response(~http_version="1.1",
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap string.quoted.double.liquidsoap
#                                 ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                  ~status_code=null(),
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                  ~status_message=null(),
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                  ~headers=[],
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                          ^^^ source.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                  ~content_type=null(),
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                  ~data=getter("")) =
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^ source.liquidsoap
>  status_code = status_code ??
#^^ source.liquidsoap
#  ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
#                            ^^ source.liquidsoap keyword.operator.coalesce.liquidsoap
>    if http_version == "1.1" and headers["expect"] == "100-continue" and getter.get(data) == "" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                                          ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^ source.liquidsoap
#                                                   ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                       ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap
#                                                                     ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                                                        ^ source.liquidsoap
#                                                                         ^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^ source.liquidsoap
#                                                                                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                                                            ^ source.liquidsoap
#                                                                                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                               ^ source.liquidsoap
#                                                                                                ^^^^ source.liquidsoap keyword.control.liquidsoap
>      100
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      200
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  http_version = ref(http_version)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  status_code = ref(status_code)
#^^ source.liquidsoap
#  ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
>  status_message = ref(status_message)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  headers = ref(headers)
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>  content_type = ref(content_type)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  data = ref(data)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
>  status_sent = ref(false)
#^^ source.liquidsoap
#  ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>  headers_sent = ref(false)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
>  data_sent = ref(false)
#^^ source.liquidsoap
#  ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>  response_ended = ref(false)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>
>  def mk_status() =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap
>    status_sent := true
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
>
>    http_version = http_version()
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>    status_code = status_code()
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>    status_code =
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
>      if status_code == 100 and getter.get(data()) != "" then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^^^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>        200
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        status_code
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    status_message = status_message() ?? http.codes[status_code]
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^ source.liquidsoap keyword.operator.coalesce.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^^^ source.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap keyword.other.liquidsoap
#                                              ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                               ^^ source.liquidsoap
>
>    "HTTP/#{http_version} #{status_code} #{status_message}\r\n"
#^^^^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#          ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#            ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                            ^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                                         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                           ^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                            ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                              ^ source.liquidsoap string.quoted.double.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def mk_headers() =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap
>    headers_sent := true
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
>
>    headers = headers()
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
>    content_type = content_type()
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>    data = data()
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
>
>    headers =
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
>      if getter.is_constant(data) then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap keyword.control.liquidsoap
>        data = getter.get(data)
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>        if data != "" then
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap keyword.control.liquidsoap
>          ("Content-Length", "#{string.length(data)}")::headers
#^^^^^^^^^^^ source.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                                                        ^^^^^^^ source.liquidsoap variable.liquidsoap
>        else
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap keyword.control.liquidsoap
>          headers
#^^^^^^^^^^ source.liquidsoap
#          ^^^^^^^ source.liquidsoap variable.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ("Transfer-Encoding", "chunked")::headers
#^^^^^^^^^ source.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
#          ^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                               ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                                          ^^^^^^^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    headers =
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
>      if null.defined(content_type) and null.get(content_type) != "" then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                              ^ source.liquidsoap
#                                                               ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                                 ^ source.liquidsoap
#                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap
#                                                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ("Content-type", null.get(content_type))::headers
#^^^^^^^^^ source.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
#          ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                                                  ^^^^^^^ source.liquidsoap variable.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        headers
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    headers = list.map(fun (v) -> "#{fst(v)}: #{snd(v)}", headers)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    headers = string.concat(separator="\r\n", headers)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>    headers = if headers != "" then "#{headers}\r\n" else "" end
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.control.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^ source.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap
#                         ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                                     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                       ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                               ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                 ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap
#                                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                                         ^ source.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                            ^ source.liquidsoap
#                                                             ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    "#{headers}\r\n"
#^^^^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#       ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#               ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                 ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def mk_data() =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^ source.liquidsoap
>    data_sent := true
#^^^^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
>
>    data = data()
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
>
>    if getter.is_constant(data) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^ source.liquidsoap keyword.control.liquidsoap
>      response_ended := true
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
>      getter.get(data)
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      data = getter.get(data)
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>      response_ended := data == ""
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap
#                             ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap
>      "#{string.hex_of_int(string.length(data))}\r\n#{data}\r\n"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#         ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                  ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                    ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                      ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                           ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                             ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                               ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def response() =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap
>    if response_ended() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>      ""
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
>    elsif not status_sent() then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>      mk_status()
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
>    elsif not headers_sent() then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap keyword.control.liquidsoap
>      mk_headers()
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      mk_data()
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def attr_method(sent, attr) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap
#                             ^^ source.liquidsoap
>    def set(v) =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap
>      if sent() then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap keyword.control.liquidsoap
>        error.raise(error.invalid, "HTTP response has already been sent for this value!")
#^^^^^^^^ source.liquidsoap
#        ^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>      attr := v
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap
#           ^^ source.liquidsoap keyword.operator.set.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>    def get() = attr() end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>    set.{current=get}
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap variable.liquidsoap
#       ^^ source.liquidsoap
#         ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                ^ source.liquidsoap
#                 ^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def header(k, v) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap
>    headers := (k, v)::headers()
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap
#            ^^ source.liquidsoap keyword.operator.set.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  code = status_code
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>  def redirect(~status_code=301, location) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap
#                                 ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap
>    if status_sent() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap keyword.control.liquidsoap
>      error.raise(error.invalid, "HTTP response has already been sent for this value!")
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>    code := status_code
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.set.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>    header("Location", location)
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def json(~compact=true, v) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
#                            ^^ source.liquidsoap
>    if headers_sent() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap keyword.control.liquidsoap
>      error.raise(error.invalid, "HTTP response has already been sent for this value!")
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>    content_type := "application/json; charset=utf-8"
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap string.quoted.double.liquidsoap
>    data := json.stringify(v, compact=compact) ^ "\n"
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.set.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^ source.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                  ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                    ^ source.liquidsoap string.quoted.double.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def html(d) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap
#           ^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap
#             ^^ source.liquidsoap
>    if headers_sent() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap keyword.control.liquidsoap
>      error.raise(error.invalid, "HTTP response has already been sent for this value!")
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>    content_type := "text/html"
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap
>    data := d
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.set.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def send_status(socket) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^ source.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap
#                         ^^ source.liquidsoap
>    if not status_sent() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>      socket.write(mk_status())
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def multipart_form(~boundary=null(), contents) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap
>    if headers_sent() then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap keyword.control.liquidsoap
>      error.raise(error.invalid, "HTTP response has already been sent for this value!")
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    form_data = http.multipart_form_data(boundary=boundary, contents)
#^^^^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
>    content_type := "multipart/form-data; boundary=#{form_data.boundary}"
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                   ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                     ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                               ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap
>    data := form_data.contents
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.set.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  response.{
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^^ source.liquidsoap
>    http_version = attr_method(status_sent, http_version),
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    status_code = attr_method(status_sent, status_code),
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    status_message = attr_method(status_sent, status_message),
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    headers = attr_method(headers_sent, headers),
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    header = header,
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    redirect = redirect,
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    json = json,
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.method.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    html = html,
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.method.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    content_type = attr_method(headers_sent, content_type),
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    multipart_form = multipart_form,
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    data = attr_method(data_sent, data),
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.method.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    send_status = send_status,
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    status_sent = {status_sent()}
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap
>  }
#^^ source.liquidsoap
#  ^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.regexp_of_path(path) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^ source.liquidsoap
>  def named_capture(s) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
>    name = string.sub(s, start=1, length=string.length(s)-1)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.arithmetic.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
>    "(?<#{name}>[^/]+)"
#^^^^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^ source.liquidsoap string.quoted.double.liquidsoap
#        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#          ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#               ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>  rex = r/:[\w_]+/g.replace(named_capture, path)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^ source.liquidsoap string.regexp.liquidsoap
#          ^^^^^^^ source.liquidsoap string.regexp.liquidsoap
#                 ^^ source.liquidsoap string.regexp.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  regexp("^#{rex}$")
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.mk_body(get_data) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
>  done = ref(false)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
>  data = ref("")
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
>  def body(~timeout=10.) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap
#                        ^^ source.liquidsoap
>    if done() then data() else
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap keyword.control.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^^ source.liquidsoap keyword.control.liquidsoap
>      start_time = time()
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>      def rec read() =
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap storage.modifier.liquidsoap
#              ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap
>        if done() then data() else
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap keyword.control.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^ source.liquidsoap keyword.control.liquidsoap
>          if start_time+timeout < time() then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                        ^^^^^^^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>            error.raise(error.http, "Timeout!")
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>
>          r = get_data(timeout=timeout)
#^^^^^^^^^^ source.liquidsoap
#          ^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>          if r == "" then data() else
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap
#               ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap keyword.control.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^ source.liquidsoap keyword.control.liquidsoap
>            data := "#{data()}#{r}"
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                       ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                              ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap
>            read()
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>      read()
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  body
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register a HTTP handler on the harbor. This function offers a simple API,
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># suitable for quick implementation of HTTP handlers. See `harbor.http.register`
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># for a node/express like alternative API.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @argsof harbor.http.register
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.argsof.liquidsoap
#         ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.register.simple(%argsof(harbor.http.register), path, handler) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                              ^ source.liquidsoap
#                                                               ^^^^ source.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                    ^ source.liquidsoap
#                                                                     ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                            ^ source.liquidsoap
#                                                                             ^^ source.liquidsoap
>  def handler(request) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
>    def data(~timeout=10.) =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
>      request.data(timeout=timeout)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>    handler(request.{
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap
>      data = data,
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      body = harbor.http.mk_body(data)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    })
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  harbor.http.register(%argsof(harbor.http.register), harbor.http.regexp_of_path(path), handler)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                  ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register a HTTP handler on the harbor with a generic regexp `path`. This function offers a simple API,
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># suitable for quick implementation of HTTP handlers. See `harbor.http.register`
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># for a node/express like alternative API.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @argsof harbor.http.register
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.argsof.liquidsoap
#         ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.register.simple.regexp(%argsof(harbor.http.register), path, handler) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                     ^ source.liquidsoap
#                                                                      ^^^^ source.liquidsoap variable.liquidsoap
#                                                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                           ^ source.liquidsoap
#                                                                            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                                   ^ source.liquidsoap
#                                                                                    ^^ source.liquidsoap
>  harbor.http.register(%argsof(harbor.http.register), path, handler)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>let harbor.http.middleware = ref(fun (req, res, next) -> next(req, res))
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                          ^ source.liquidsoap
#                           ^^ source.liquidsoap
#                             ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                    ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                              ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                   ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>
># Register a new harbor middleware
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.middleware.register(fn) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^ source.liquidsoap
>  middleware = harbor.http.middleware()
#^^ source.liquidsoap
#  ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^ source.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>  harbor.http.middleware := fun (req, res, next) -> begin
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                        ^ source.liquidsoap
#                         ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^ source.liquidsoap keyword.other.function.definition.params.liquidsoap
#                               ^^ source.liquidsoap
#                                 ^^^^^^^^^^^^^^ source.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^ source.liquidsoap
#                                                 ^^ source.liquidsoap keyword.control.function.declaration.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^^ source.liquidsoap keyword.control.liquidsoap
>    middleware(req, res, fun (res, res) ->
#^^^^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
>      fn(req, res, next))
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.register.regexp(%argsof(harbor.http.register), path, handler) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                              ^ source.liquidsoap
#                                                               ^^^^ source.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                    ^ source.liquidsoap
#                                                                     ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                            ^ source.liquidsoap
#                                                                             ^^ source.liquidsoap
>  def handler(request) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
>    response = http.response(
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>      http_version=request.http_version,
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                           ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    )
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
>
>    is_response_done = ref(false)
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^^ source.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>
>    def replaces response() =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#                 ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap
#                           ^^ source.liquidsoap
>      ret = response()
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
>      is_response_done := ret == ""
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap
#                       ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap
#                              ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap
>      ret
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>    def data(~timeout=10.) =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
>      if is_response_done() then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>        error.raise(error.http, "Response ended!")
#^^^^^^^^ source.liquidsoap
#        ^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>      if response.status_code.current() == 100 and not response.status_sent() then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap
#                  ^^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                              ^ source.liquidsoap
#                                               ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                                      ^ source.liquidsoap
#                                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                             ^ source.liquidsoap
#                                                                              ^^^^ source.liquidsoap keyword.control.liquidsoap
>        response.send_status(request.socket)
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>      request.data(timeout=timeout)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>    request = {
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap
>      body = harbor.http.mk_body(data),
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^ source.liquidsoap variable.method.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      data = data,
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      headers = request.headers,
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      http_version = request.http_version,
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^^^ source.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      method = request.method,
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap keyword.other.liquidsoap
#                       ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      path = request.path,
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^ source.liquidsoap variable.method.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      query = request.query
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap entity.name.method.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^ source.liquidsoap variable.method.liquidsoap
>    }
#^^^^ source.liquidsoap
#    ^ source.liquidsoap
>
>    handler = fun (req, res) -> begin
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^ source.liquidsoap keyword.other.function.definition.params.liquidsoap
#                 ^^ source.liquidsoap
#                   ^^^^^^^^ source.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap
#                             ^^ source.liquidsoap keyword.control.function.declaration.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^^ source.liquidsoap keyword.control.liquidsoap
>      middleware = harbor.http.middleware()
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap
#                          ^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>      middleware(req, res, fun (req, res) -> handler(req, res))
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                          ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    (handler(request, response):unit)
#^^^^^ source.liquidsoap
#     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#                                ^^^^ source.liquidsoap meta.type-annotation.liquidsoap storage.type.ground.liquidsoap
#                                    ^ source.liquidsoap meta.type-annotation.liquidsoap
>
>    response
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap variable.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  harbor.http.register(%argsof(harbor.http.register), path, handler)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>def replaces harbor.http.middleware = () end
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#             ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                   ^^ source.liquidsoap
#                                     ^^^^ source.liquidsoap
#                                         ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register a HTTP handler on the harbor. The handler function
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># receives as argument the full requested information and returns the
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># answer sent to the client, including HTTP headers. This function
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># registers exact path matches, i.e. `"/users"`, `"/index.hml"`
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># as well as fragment matches, i.e. `"/user/:id"`, `"/users/:id/collabs/:cid"`,
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># etc. If you need more advanced matching, use `harbor.http.register.regexp`
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># to match regular expressions. Paths are resolved in the order they are declared
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># and can override default harbor paths such as metadata handlers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># The handler receives the request details as a record and a response
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># handler. Matched fragments are reported as part of the response `query` parameter.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># The response handler can be used to fill up details about the http response,
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># which will be converted into a plain HTTP response string after the handler returns.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @argsof harbor.http.register
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.argsof.liquidsoap
#         ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def replaces harbor.http.register(%argsof(harbor.http.register), path, handler) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#             ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                ^ source.liquidsoap
#                                                                 ^^^^ source.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                      ^ source.liquidsoap
#                                                                       ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                              ^ source.liquidsoap
#                                                                               ^^ source.liquidsoap
>  harbor.http.register.regexp(%argsof(harbor.http.register), harbor.http.regexp_of_path(path), handler)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                         ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>let harbor.http.static = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^^ source.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def harbor.http.static.base(serve,~content_type,~basepath,~headers,~browse,directory) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap
#                                   ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^ source.liquidsoap
#                                                 ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                          ^ source.liquidsoap
#                                                           ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                   ^ source.liquidsoap
#                                                                    ^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                           ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                                    ^ source.liquidsoap
#                                                                                     ^^ source.liquidsoap
>  directory = path.home.unrelate(directory)
#^^ source.liquidsoap
#  ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap keyword.other.liquidsoap
#                   ^^^^ source.liquidsoap variable.method.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  basepath =
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
>    if string.sub(basepath,start=0,length=1) != "/" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "/#{basepath}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
#        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#          ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      basepath
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  basepath =
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
>    if string.sub(basepath,start=string.length(basepath)-1,length=1) != "/" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.arithmetic.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                    ^ source.liquidsoap
#                                                                     ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                                       ^ source.liquidsoap
#                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                           ^ source.liquidsoap
#                                                                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>      basepath^"/"
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      basepath
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  def handler(request, response)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                      ^ source.liquidsoap
#                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap
>    response.headers(headers)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>
>    rpath = string.residual(prefix=basepath, request.path)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
>    if not null.defined(rpath) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>      response.status_code(404)
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      rpath = null.get(rpath)
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>      fname = path.concat(directory, rpath)
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>      log.debug("Serving static file: #{fname}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>      if not file.exists(fname) then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^ source.liquidsoap keyword.control.liquidsoap
>        response.status_code(404)
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        if file.is_directory(fname) then
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^^ source.liquidsoap keyword.control.liquidsoap
>          if not browse then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>            response.status_code(403)
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
>          else
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap keyword.control.liquidsoap
>            page = ref("")
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>            def add(s)
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
>              page := page() ^ s ^ "\n"
#^^^^^^^^^^^^^^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap
#                               ^ source.liquidsoap variable.liquidsoap
#                                ^^^ source.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap
>            end
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>            def add_file(f)
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap
>              add("<li><a href=\"#{request.path}#{url.encode(f)}\">#{f}</a></li>")
#^^^^^^^^^^^^^^ source.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                 ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                  ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                       ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>            end
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>            add("<html><body><ul>")
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>            list.iter(add_file, file.ls(sorted=true, fname))
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
>            add("</ul></body>")
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>            response.content_type("text/html; charset=UTF-8")
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
>            response.data(string.getter.single(page()))
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>        else
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap keyword.control.liquidsoap
>          mime = content_type(fname)
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
>          if null.defined(mime) then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^ source.liquidsoap keyword.control.liquidsoap
>            response.content_type(null.get(mime))
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>
>          if request.method == "GET" then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                           ^ source.liquidsoap
#                            ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                              ^ source.liquidsoap
#                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
>            response.data(file.read(fname))
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  basepath = "#{basepath}.*"
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
>  def register(method)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
>    serve(method=method, basepath, handler)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>  list.iter(register, ["OPTIONS","HEAD","GET"])
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># It seems that browsers want a trailing 0 for floats.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.string_of_float(x)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap
>  s = string(x)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>  n = string.length(s)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
>  if string.sub(s, start=n-1, length=1) == "." then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.arithmetic.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap
#                                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>    s ^ "0"
#^^^^ source.liquidsoap
#    ^ source.liquidsoap variable.liquidsoap
#     ^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    s
#^^^^ source.liquidsoap
#    ^ source.liquidsoap variable.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def get_mime_process(file) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
>  mime = list.hd(default="", process.read.lines("file -b -I #{process.quote(file)}"))
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  if mime == "" then null() else mime end
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap
#          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap keyword.control.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>content_type = get_mime_process
#^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>%ifdef file.mime
#^^^^^^ source.liquidsoap keyword.other.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap keyword.other.liquidsoap
#            ^^^^ source.liquidsoap variable.method.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>content_type = file.mime
#^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^ source.liquidsoap variable.method.liquidsoap
>%endif
#^^^^^^ source.liquidsoap keyword.other.liquidsoap
>
># Serve a static path.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~port Port for incoming harbor (http) connections.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~transport Http transport. Use `http.transport.ssl` or http.transport.secure_transport`, when available, to enable HTTPS output
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~path Base path.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~headers Default response headers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~browse List files in directories.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~content_type Callback to specify Content-Type on a per file basis. Default: file.mime if compiled or file CLI if present.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param directory Local path to be served.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def replaces harbor.http.static(~transport=http.transport.unix,~port=8000,~path="/",~browse=false,~content_type=(content_type:(string)->string?),~headers=[("Access-Control-Allow-Origin","*")],directory) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#             ^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap keyword.other.liquidsoap
#                                                ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                         ^ source.liquidsoap keyword.other.liquidsoap
#                                                          ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                               ^ source.liquidsoap
#                                                                ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                    ^ source.liquidsoap
#                                                                     ^^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                          ^ source.liquidsoap
#                                                                           ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                               ^ source.liquidsoap
#                                                                                ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                    ^ source.liquidsoap
#                                                                                     ^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                           ^ source.liquidsoap
#                                                                                            ^^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                                                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                  ^ source.liquidsoap
#                                                                                                   ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                               ^^ source.liquidsoap
#                                                                                                                 ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                                                                             ^ source.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#                                                                                                                              ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                               ^^^^^^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                     ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                      ^^^^^^^^^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                               ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                 ^ source.liquidsoap
#                                                                                                                                                  ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                                                         ^^^ source.liquidsoap
#                                                                                                                                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                                             ^ source.liquidsoap
#                                                                                                                                                                                              ^^^^^^^^^^^^ source.liquidsoap
#                                                                                                                                                                                                          ^^ source.liquidsoap
>  # Make the method argument non-optional, see #1018
#^^ source.liquidsoap
#  ^ source.liquidsoap comment.line.number-sign.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>  serve = fun(~method,uri,handler) -> harbor.http.register(transport=transport,port=port,method=method,uri,handler)
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.other.function.definition.params.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^ source.liquidsoap keyword.control.function.declaration.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap keyword.other.liquidsoap
#                                             ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                                           ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                     ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>  harbor.http.static.base(serve,content_type=content_type,basepath=path,browse=browse,headers=headers,directory)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^ source.liquidsoap variable.method.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                      ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>stdlib_file = file
#^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>upload_file_fn = fun (~name, ~content_type, ~headers, ~boundary, ~filename, ~file, ~contents, ~timeout, ~redirect, url, fn) -> begin
#^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^ source.liquidsoap keyword.other.function.definition.params.liquidsoap
#                    ^^ source.liquidsoap
#                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                                                                                                                          ^ source.liquidsoap
#                                                                                                                           ^ source.liquidsoap
#                                                                                                                            ^^ source.liquidsoap keyword.control.function.declaration.liquidsoap
#                                                                                                                              ^ source.liquidsoap
#                                                                                                                               ^^^^^ source.liquidsoap keyword.control.liquidsoap
>  if not null.defined(filename) and not null.defined(file) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap
#                                                           ^^^^ source.liquidsoap keyword.control.liquidsoap
>    error.raise(error.http, "At least one of: `file` or `filename` must be defined!")
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  if null.defined(file) and null.defined(contents) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^^^^ source.liquidsoap keyword.control.liquidsoap
>    error.raise(error.http, "Only one of: `contents` or `file` must be defined!")
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  # Massage parameters
#^^ source.liquidsoap
#  ^ source.liquidsoap comment.line.number-sign.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>  filename = null.defined(filename) ? null.get(filename) : string(path.basename(null.get(file)))
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap keyword.control.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^ source.liquidsoap keyword.control.liquidsoap
#                                                          ^ source.liquidsoap
#                                                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                     ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  contents = null.defined(contents) ? null.get(contents) : getter(stdlib_file.read(null.get(file)))
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap keyword.control.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^ source.liquidsoap keyword.control.liquidsoap
#                                                          ^ source.liquidsoap
#                                                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                  ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>
>  # Create query
#^^ source.liquidsoap
#  ^ source.liquidsoap comment.line.number-sign.liquidsoap
#   ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
>  content_type = content_type ?? "application/octet-stream"
#^^ source.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap
#                              ^^ source.liquidsoap keyword.operator.coalesce.liquidsoap
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
>
>  data = http.multipart_form_data(boundary=boundary, [{
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                    ^^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    name=name,
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    attributes=[("filename", filename)],
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    headers=[("Content-Type",content_type)],
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>    contents=contents
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>  }])
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap
#   ^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
>  headers = ("Content-Type", "multipart/form-data; boundary=#{data.boundary}")::headers
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                            ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                              ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                                   ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                           ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^ source.liquidsoap
#                                                                              ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                                                                                ^^^^^^^ source.liquidsoap variable.liquidsoap
>
>  fn(headers=headers, timeout=timeout, redirect=redirect, data=data.contents, url)
#^^ source.liquidsoap
#  ^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
#     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                              ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.control.liquidsoap
>
># Send a file via POST request encoded in multipart/form-data. The contents can
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># either be directly specified (with the `contents` argument) or taken from a
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># file (with the `file` argument).
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~name Name of the field field
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~content_type Content-type (mime) for the file.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~headers Additional headers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~boundary Specify boundary to use for multipart/form-data.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~filename File name sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~file File whose contents is to be sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~contents Contents of the file sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~timeout Timeout in seconds.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~redirect Follow reidrections.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param url URL to post to.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.post.file(~name="file", ~content_type=null(), ~headers=[], ~boundary=null(), ~filename=null(), ~file=null(), ~contents=null(), ~timeout=null(), ~redirect=true, url)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                              ^ source.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap
#                                                       ^ source.liquidsoap
#                                                        ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                               ^^^ source.liquidsoap
#                                                                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                   ^ source.liquidsoap
#                                                                    ^ source.liquidsoap
#                                                                     ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                             ^ source.liquidsoap
#                                                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                     ^ source.liquidsoap
#                                                                                      ^ source.liquidsoap
#                                                                                       ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                               ^ source.liquidsoap
#                                                                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                       ^ source.liquidsoap
#                                                                                                        ^ source.liquidsoap
#                                                                                                         ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                             ^ source.liquidsoap
#                                                                                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                     ^ source.liquidsoap
#                                                                                                                      ^ source.liquidsoap
#                                                                                                                       ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                               ^ source.liquidsoap
#                                                                                                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                       ^ source.liquidsoap
#                                                                                                                                        ^ source.liquidsoap
#                                                                                                                                         ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                                                ^ source.liquidsoap
#                                                                                                                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                        ^ source.liquidsoap
#                                                                                                                                                         ^ source.liquidsoap
#                                                                                                                                                          ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                                                                  ^ source.liquidsoap
#                                                                                                                                                                   ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                                                                                                                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                                        ^ source.liquidsoap
#                                                                                                                                                                         ^^^ source.liquidsoap variable.liquidsoap
#                                                                                                                                                                            ^ source.liquidsoap
>  upload_file_fn(name=name, content_type=content_type, headers=headers, boundary=boundary, filename=filename,
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                        ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                           ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                 file=file, contents=contents, timeout=timeout, redirect=redirect, url, http.post)
#^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Send a file via PUT request encoded in multipart/form-data. The contents can
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># either be directly specified (with the `contents` argument) or taken from a
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># file (with the `file` argument).
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~name Name of the field field
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~content_type Content-type (mime) for the file.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~headers Additional headers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~boundary Specify boundary to use for multipart/form-data.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~filename File name sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~file File whose contents is to be sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~contents Contents of the file sent in the request.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~timeout Timeout in seconds.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~redirect Follow reidrections.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param url URL to put to.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.put.file(~name="file", ~content_type=null(), ~headers=[], ~boundary=null(), ~filename=null(), ~file=null(), ~contents=null(), ~timeout=null(), ~redirect=true, url)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                             ^ source.liquidsoap
#                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                     ^ source.liquidsoap
#                                                      ^ source.liquidsoap
#                                                       ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                              ^^^ source.liquidsoap
#                                                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                  ^ source.liquidsoap
#                                                                   ^ source.liquidsoap
#                                                                    ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                            ^ source.liquidsoap
#                                                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                    ^ source.liquidsoap
#                                                                                     ^ source.liquidsoap
#                                                                                      ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                              ^ source.liquidsoap
#                                                                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                      ^ source.liquidsoap
#                                                                                                       ^ source.liquidsoap
#                                                                                                        ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                            ^ source.liquidsoap
#                                                                                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                    ^ source.liquidsoap
#                                                                                                                     ^ source.liquidsoap
#                                                                                                                      ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                              ^ source.liquidsoap
#                                                                                                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                      ^ source.liquidsoap
#                                                                                                                                       ^ source.liquidsoap
#                                                                                                                                        ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                                               ^ source.liquidsoap
#                                                                                                                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                       ^ source.liquidsoap
#                                                                                                                                                        ^ source.liquidsoap
#                                                                                                                                                         ^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                                                                                                 ^ source.liquidsoap
#                                                                                                                                                                  ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                                                                                                                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                                                       ^ source.liquidsoap
#                                                                                                                                                                        ^^^ source.liquidsoap variable.liquidsoap
#                                                                                                                                                                           ^ source.liquidsoap
>  upload_file_fn(name=name, content_type=content_type, headers=headers, boundary=boundary, filename=filename,
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                        ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                           ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                 file=file, contents=contents, timeout=timeout, redirect=redirect, url, http.put)
#^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                                             ^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>let harbor.http.request = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^ source.liquidsoap
>
>let settings.http = settings.make.void(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^ source.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>  "Settings for HTTP requests"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>let settings.http.mime = settings.make.void(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap
#                       ^^ source.liquidsoap
#                         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap
#                                  ^^^^ source.liquidsoap variable.method.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>  "MIME-related settings for HTTP requests"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.http.mime.extnames = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  description="MIME to file extension mappings", [
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^^^ source.liquidsoap meta.function-call.liquidsoap
>  ("audio/mp3", ".mp3"),
#^^^ source.liquidsoap meta.function-call.liquidsoap
#   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/mpeg", ".mp3"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("application/ogg", ".ogg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("application/x-ogg", ".ogg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/x-ogg", ".ogg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/ogg", ".ogg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("video/ogg", ".ogg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/flac", ".flac"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/x-flac", ".flac"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/mp4", ".mp4"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("application/mp4", ".mp4"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("video/mp4", ".mp4"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/vnd.wave", ".wav"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/wav", ".wav"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/wave", ".wav"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("audio/x-wav", ".wav"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("image/jpeg", ".jpg"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("image/png", ".png"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("application/pdf", ".pdf"),
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ("image/bmp", ".bmp")
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap
>])
#^^^ source.liquidsoap
>
>let http.headers = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^ source.liquidsoap
>
># Extract the content-type header
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.headers.content_type(headers) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^ source.liquidsoap
>  mime =
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
>    try
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>      list.find(fun (v) -> begin
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>        let (header_name, _) = v
#^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#           ^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>        string.case(lower=true, header_name) == "content-type"
#^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>      end, headers)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
>    catch _ : [error.not_found] do
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.other.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^ source.liquidsoap
#               ^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^^ source.liquidsoap
#                                ^^ source.liquidsoap keyword.other.liquidsoap
>      null()
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  mime = null.map(snd, mime)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>
>  null.map(fun (mime) -> begin
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>    let [mime, ...args] = list.map(string.trim, string.split(separator=";", mime))
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.spread.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                             ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>
>    def parse_arg(arg) =
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^ source.liquidsoap meta.function-call.liquidsoap
>      let [name, ...value] = string.split(separator="=", arg)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.spread.liquidsoap
#                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                         ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>      (name, string.unquote(string.concat(separator="=", value)))
#^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                ^^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.end.liquidsoap
>
>    {mime=mime, args=list.map(parse_arg, args)}
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
#     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>  end, mime)
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract the content-disposition header
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.headers.content_disposition(headers) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^^ source.liquidsoap
>  content_disposition =
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^^ source.liquidsoap
>    try
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>      list.find(fun (v) -> begin
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>        let (header_name, _) = v
#^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#           ^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>        string.case(lower=true, header_name) == "content-disposition"
#^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>      end, headers)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
>    catch _ : [error.not_found] do
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.other.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^ source.liquidsoap
#               ^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^^ source.liquidsoap
#                                ^^ source.liquidsoap keyword.other.liquidsoap
>      null()
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  def parse_arg(arg) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap
>    let [name, ...value] = string.split(separator="=", arg)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap
#         ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap
#               ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^ source.liquidsoap
#                           ^^^^^^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>    (name, string.unquote(string.concat(separator="=", value)))
#^^^^^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#          ^ source.liquidsoap
#           ^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                              ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def parse_filename(args) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
>    plain_filename = args["filename"]
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^^ source.liquidsoap
>    plain_filename = plain_filename == "" ? null() : plain_filename
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^ source.liquidsoap keyword.control.liquidsoap
#                                           ^ source.liquidsoap
#                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^ source.liquidsoap keyword.control.liquidsoap
#                                                    ^ source.liquidsoap
#                                                     ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>
>    encoded_filename = args["filename*"]
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^^ source.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                       ^^ source.liquidsoap
>    encoded_filename = encoded_filename == "" ? null() : encoded_filename
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^^ source.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap
#                                              ^ source.liquidsoap keyword.control.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap
#                                                       ^ source.liquidsoap keyword.control.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>    encoded_filename = null.map(fun (encoded_filename) -> begin
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^^ source.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>      let [encoding, _, filename] = string.split(separator="'", encoded_filename)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>      string.recode(in_enc=encoding, filename)
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    end, encoded_filename)
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>
>    filename = null.defined(encoded_filename) ? encoded_filename : plain_filename
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap
#                                              ^ source.liquidsoap keyword.control.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap
#                                                                 ^ source.liquidsoap keyword.control.liquidsoap
#                                                                  ^ source.liquidsoap
#                                                                   ^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>    filename = null.map(fun (filename) -> url.decode(string.unquote(filename)), filename)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>    (filename, list.filter(fun (v) -> fst(v) != "filename" and fst(v) != "filename*", args))
#^^^^^ source.liquidsoap
#     ^^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                                           ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.boolean.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                           ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def parse_name(args) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
>    name = args["name"]
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap
>    name = name == "" ? null() : name
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap keyword.control.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap
#                               ^ source.liquidsoap keyword.control.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^ source.liquidsoap variable.liquidsoap
>    name = null.map(fun (name) -> url.decode(string.unquote(name)), name)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                         ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>    (name, list.filter(fun (v) -> fst(v) != "name", args))
#^^^^^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  null.map(fun (v) -> begin
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>    let (_, header_value) = v
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>    let [type, ...args] = list.map(string.trim, string.split(separator=";", header_value))
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.spread.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                             ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                            ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    args = list.map(parse_arg, args)
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap meta.function-call.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    let (filename, args) = parse_filename(args)
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    let (name, args) = parse_name(args)
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#       ^^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    ({type = type, filename = filename, name = name, args = args}:{ type: string, filename?: string, name?: string, args: [(string*string?)]})
#^^^^^ source.liquidsoap meta.function-call.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#          ^^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.method.liquidsoap
#                                                         ^^ source.liquidsoap meta.function-call.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap entity.name.method.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                 ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                    ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap entity.name.method.liquidsoap
#                                                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                            ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                                                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
>  end, content_disposition)
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Try to get a filename from a request's headers.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Internet
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def http.headers.extname(headers) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
>  content_disposition = http.headers.content_disposition(headers)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^^ source.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>  content_type = http.headers.content_type(headers)
#^^ source.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>
>  extname =
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
>    if null.defined(content_disposition?.filename) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                 ^^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>      extname = file.extension(null.get(content_disposition?.filename))
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#             ^^^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                     ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>      extname == "" ? null() : extname
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>    else
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>      null()
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>
>  if null.defined(extname) then
#^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#  ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#     ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>    extname
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>  elsif null.defined(content_type) then
#^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#  ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#        ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>    extnames = settings.http.mime.extnames()
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                             ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    extname = extnames[null.get(content_type).mime]
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                  ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>    extname == "" ? null() : extname
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#            ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>  else
#^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>    null()
#^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>