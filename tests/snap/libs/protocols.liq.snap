># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def settings.make.protocol(name) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
>  settings.make.void(
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap
#           ^^^^ source.liquidsoap variable.method.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
>    "Settings for the #{name} protocol"
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                             ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>  )
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>let settings.protocol = settings.make.void(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
#                        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap keyword.other.liquidsoap
#                                 ^^^^ source.liquidsoap variable.method.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  "Settings for registered protocols"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.replaygain = settings.make.protocol("ReplayGain")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap keyword.other.liquidsoap
#                                            ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>let settings.protocol.replaygain.tag = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^ source.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Tag used to annotate ReplayGain",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "replaygain_track_gain"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the replaygain protocol.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.replaygain(~rlog=_,~maxtime=_,arg)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^^^ source.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap
>  gain = file.replaygain(arg)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>  tag = settings.protocol.replaygain.tag()
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap
#                 ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap
#                          ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
>  if null.defined(gain) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>    ["annotate:#{tag}=\"#{null.get(gain)} dB\":#{arg}"]
#^^^^^ source.liquidsoap
#     ^ source.liquidsoap string.quoted.double.liquidsoap
#      ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#               ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                 ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                          ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                               ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                         ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                                               ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                 ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                      ^^ source.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    [arg]
#^^^^^ source.liquidsoap
#     ^^^ source.liquidsoap variable.liquidsoap
#        ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("replaygain", protocol.replaygain,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="replaygain:uri",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Compute ReplayGain value. \
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  Adds returned value as `\"replaygain_track_gain\"` metadata")
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                            ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                   ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.process = settings.make.protocol("process")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                             ^ source.liquidsoap
#                              ^^ source.liquidsoap
#                                ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap keyword.other.liquidsoap
#                                         ^^^^ source.liquidsoap variable.method.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.process.env = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^ source.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  description="List of environment variables \
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>               passed down to the executed process.",
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  []
#^^^^^ source.liquidsoap meta.function-call.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.process.inherit_env = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap
#                                            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Inherit calling process's environment when `env` parameter is empty.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  true
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let protocol.process = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^^ source.liquidsoap
>
># Parse process protocol arguments
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.process.parse(~default_timeout,arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap
>  let [args, ...uri] = r/:/.split(arg)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#     ^^ source.liquidsoap
#       ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#            ^ source.liquidsoap
#             ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^ source.liquidsoap
#                       ^^ source.liquidsoap string.regexp.liquidsoap
#                         ^ source.liquidsoap string.regexp.liquidsoap
#                          ^ source.liquidsoap string.regexp.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  uri = string.concat(separator=":", uri)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
>  args = r/,/.split(args)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap string.regexp.liquidsoap
#           ^ source.liquidsoap string.regexp.liquidsoap
#            ^ source.liquidsoap string.regexp.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>  let args =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#     ^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap
#           ^^ source.liquidsoap
>    if string.contains(prefix="timeout=", list.hd(args)) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>      let [timeout, extname, ...cmd] = args
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap
#           ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                   ^ source.liquidsoap
#                    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap
#                             ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                                ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^ source.liquidsoap
#                                       ^^^^ source.liquidsoap variable.liquidsoap
>      timeout = string.residual(prefix="timeout=", timeout)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>      timeout = null.map(string.to_float, timeout) ?? default_timeout
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^^ source.liquidsoap keyword.operator.coalesce.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>      timeout = min(default_timeout, timeout)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>      {timeout=timeout, extname=extname, cmd=cmd}
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                       ^ source.liquidsoap
#                        ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                        ^ source.liquidsoap
#                                         ^^^ source.liquidsoap entity.name.method.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      let [extname, ...cmd] = args
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap
#           ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                   ^ source.liquidsoap
#                    ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                       ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^ source.liquidsoap
#                              ^^^^ source.liquidsoap variable.liquidsoap
>      {timeout=default_timeout,  extname=extname, cmd=cmd}
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap entity.name.method.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                 ^ source.liquidsoap
#                                                  ^^^ source.liquidsoap entity.name.method.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^^^ source.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  args.{uri=uri,cmd=string.concat(separator=",",args.cmd)}
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.method.liquidsoap
#           ^ source.liquidsoap
#            ^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^^^ source.liquidsoap entity.name.method.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^^^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                     ^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register the process protocol. Syntax:
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># process:[timeout=<seconds>],<output ext>,<cmd>:uri where `timeout` argument is optional and
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># cannot exceed the underlying time and <cmd> is interpolated with:
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># [("input",<input file>),("output",<output file>),("colon",":")]
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># See say: protocol for an example.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def replaces protocol.process(~rlog=_,~maxtime,arg)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#             ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap
#                                       ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^^^ source.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap
>  log.info("Processing #{arg}")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap variable.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                       ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>  let {uri, timeout, extname, cmd} = protocol.process.parse(default_timeout=maxtime-time(),arg)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#     ^^ source.liquidsoap
#       ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                    ^ source.liquidsoap
#                     ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap
#                              ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^ source.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap keyword.other.liquidsoap
#                                              ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.arithmetic.liquidsoap
#                                                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                           ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>  output = file.temp("liq-process", ".#{extname}")
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>
>  def resolve(input) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap
>    cmd = cmd % [("input",process.quote(input)),
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap variable.liquidsoap
#             ^^^^^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap
#                                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                 ("output",process.quote(output)),
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^^^^^^^ source.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap
#                                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>                 ("colon",":")]
#^^^^^^^^^^^^^^^^^^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^^^ source.liquidsoap
>
>    log.info("Executing #{cmd}")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap variable.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                          ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
>
>    env_vars = settings.protocol.process.env()
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                ^ source.liquidsoap keyword.other.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>    env = environment()
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
>    def get_env(k) = (k,env[k]) end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap
#                    ^^ source.liquidsoap
#                      ^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^^^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap variable.liquidsoap
#                             ^^^ source.liquidsoap
#                                ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>    env = list.map(get_env,env_vars)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
>    inherit_env = settings.protocol.process.inherit_env()
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap
#                           ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                   ^ source.liquidsoap keyword.other.liquidsoap
#                                    ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>    p = process.run(timeout=timeout, env=env, inherit_env=inherit_env, cmd)
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>    if p.status == "exit" and p.status.code == 0 then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap keyword.other.liquidsoap
#         ^^^^^^ source.liquidsoap variable.method.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap
#                                ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap
#                                       ^^^^ source.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap
#                                            ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                              ^ source.liquidsoap
#                                               ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                ^ source.liquidsoap
#                                                 ^^^^ source.liquidsoap keyword.control.liquidsoap
>      [output]
#^^^^^^^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log.important("Failed to execute #{cmd}: #{p.status} (#{p.status.code})")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>      log.info("Standard output:\n#{p.stdout}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                  ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>      log.info("Error output:\n#{p.stderr}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>      log.info("Removing #{output}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
>      file.remove(output)
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>      []
#^^^^^^^^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  if uri == "" then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap keyword.control.liquidsoap
>    resolve("")
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    r = request.create(uri)
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
>    delay = maxtime - time()
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>    if request.resolve(timeout=delay,r) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>      res = resolve(request.filename(r))
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
>      request.destroy(r)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>      res
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log(level=3,"Failed to resolve #{uri}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>      []
#^^^^^^^^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(temporary=true, "process", protocol.process,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                 ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Resolve a request using an arbitrary process. \
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  `<cmd>` is interpolated with: \
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  `[(\"input\",<input>),(\"output\",<output>),\
#^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                              ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                   ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  (\"colon\",\":\")]`. `uri` is an optional child request, \
#^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  `<output>` is the name of a fresh temporary file and has \
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  extension `.<extname>`. `<input>` is an optional input \
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  file name as returned while resolving `uri`.",
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="process:<extname>,<cmd>[:uri]")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
># Create a process: uri, replacing `:` with `$(colon)`.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Liquidsoap
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param cmd Command line to execute
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~extname Output file extension (with no leading '.')
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~uri Input uri
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def process.uri(~timeout=null(),~extname,~uri="",cmd) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap
#                                          ^^^ source.liquidsoap variable.parameter.liquidsoap
#                                             ^ source.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                 ^^^ source.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap
#                                                     ^^ source.liquidsoap
>  timeout = null.case(timeout, {""}, fun(t) -> "timeout=" ^ string(t) ^ ",")
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                     ^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
>  cmd = r/:/.replace(fun (_) -> "$(colon)",cmd)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^ source.liquidsoap string.regexp.liquidsoap
#          ^ source.liquidsoap string.regexp.liquidsoap
#           ^ source.liquidsoap string.regexp.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                        ^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>  uri = if uri != "" then ":#{uri}" else "" end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap
#               ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap keyword.control.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                              ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap
#                                            ^^^ source.liquidsoap keyword.control.liquidsoap
>  "process:#{timeout}#{extname},#{cmd}#{uri}"
#^^ source.liquidsoap
#  ^ source.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                       ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                  ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                      ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Resolve http(s) URLs using curl
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.http(proto,~rlog,~maxtime,arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^ source.liquidsoap
#                               ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^ source.liquidsoap
>  uri = "#{proto}:#{arg}"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
>
>  def log(~level,s) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                 ^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap
>    rlog(s)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
>    log(label="procol.external",level=level,s)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  timeout = maxtime - time()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>
>  ret = http.head(timeout=timeout, uri)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>  code = ret.status_code ?? 999
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                        ^ source.liquidsoap
#                         ^^ source.liquidsoap keyword.operator.coalesce.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
>  extname = 200 <= code and code < 300 ? http.headers.extname(ret.headers) : null()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#               ^ source.liquidsoap
#                ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^ source.liquidsoap keyword.control.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^^^ source.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap keyword.other.liquidsoap
#                                              ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                              ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                          ^ source.liquidsoap
#                                                                           ^ source.liquidsoap keyword.control.liquidsoap
#                                                                            ^ source.liquidsoap
#                                                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>
>  extname =
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
>    if null.defined(extname) then null.get(extname) else begin
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                                        ^ source.liquidsoap
#                                                         ^^^^^ source.liquidsoap keyword.control.liquidsoap
>      content_type = http.headers.content_type(ret.headers)
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap
#                          ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>      extra_log =
#^^^^^^ source.liquidsoap
#      ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
>        if null.defined(content_type) and null.get(content_type).mime != "" then begin
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^^^ source.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                ^ source.liquidsoap keyword.other.liquidsoap
#                                                                 ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                                     ^ source.liquidsoap
#                                                                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                                                        ^ source.liquidsoap
#                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                           ^ source.liquidsoap
#                                                                            ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                                                                ^ source.liquidsoap
#                                                                                 ^^^^^ source.liquidsoap keyword.control.liquidsoap
>          content_type = null.get(content_type).mime
#^^^^^^^^^^ source.liquidsoap
#          ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^^ source.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap keyword.other.liquidsoap
#                                                ^^^^ source.liquidsoap variable.method.liquidsoap
>          " Response has unknown mime-type: #{string.quote(content_type)} you may want to add it to `settings.http.mime.extnames` and report to us if it is a common one."
#^^^^^^^^^^ source.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                           ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap
>        end else
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap keyword.control.liquidsoap
>          ""
#^^^^^^^^^^ source.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      log(level=3, "Failed to find a file extension for #{string.quote(uri)}.#{extra_log}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                       ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                               ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>      ".osb"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  output = file.temp("liq-process", extname)
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>
>  file_writer = file.write.stream(output)
#^^ source.liquidsoap
#  ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^ source.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>  timeout = maxtime - time()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>
>  try
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>    response = http.get.stream(
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^ source.liquidsoap variable.method.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>      on_body_data=file_writer,
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      timeout=timeout,
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>      uri
#^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
>    )
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
>
>    if response.status_code < 400 then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap
#                ^^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap keyword.control.liquidsoap
>      [output]
#^^^^^^^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log(level=3, "Error while fetching http data: #{response.status_code} - #{response.status_message}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                               ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                           ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.other.liquidsoap
#                                                                                         ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.method.liquidsoap
#                                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap
>      []
#^^^^^^^^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  catch err do
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap keyword.control.liquidsoap
#       ^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^^ source.liquidsoap keyword.control.liquidsoap
>    log(level=3, "Error while fetching http data: #{err}")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
>    []
#^^^^^^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register download protocol.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.add.http(proto) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
#                            ^^ source.liquidsoap
>  def protocol.http(~rlog,~maxtime,arg) = protocol.http(proto,rlog=rlog,maxtime=maxtime,arg) end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^^^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^ source.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                        ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                            ^ source.liquidsoap
#                                                                                             ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>  protocol.add(temporary=true,syntax="#{proto}://...",doc="Download http URLs using curl",proto,protocol.http)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                                                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>list.iter(protocol.add.http,["http","https"])
#^^^^ source.liquidsoap variable.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap
#     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.youtube_dl = settings.make.protocol("youtube-dl")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap keyword.other.liquidsoap
#                                            ^^^^ source.liquidsoap variable.method.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.youtube_dl.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^ source.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path of the youtube-dl (or yt-dlp) binary.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "yt-dlp"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.youtube_dl.timeout = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^ source.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Timeout (in seconds) for youtube-dl executions.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  300.
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#     ^^ source.liquidsoap meta.function-call.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the youtube-dl protocol, using youtube-dl.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># Syntax: youtube-dl:<ID>
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.youtube_dl(~rlog,~maxtime,arg)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^ source.liquidsoap
#                               ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap
>  binary = settings.protocol.youtube_dl.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>  timeout = settings.protocol.youtube_dl.timeout()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap
#                              ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>
>  def log(~level,s) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                 ^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap
>    rlog(s)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
>    log(label="protocol.youtube-dl",level=level,s)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  delay = maxtime - time()
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>  cmd = "#{binary} --get-title --get-filename -- #{process.quote(arg)}"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                   ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                           ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                 ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                      ^ source.liquidsoap string.quoted.double.liquidsoap
>  log(level=4,"Executing #{cmd}")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>  x = process.read.lines(timeout=delay,cmd)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^ source.liquidsoap variable.method.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>  x =
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
>    if list.length(x) >= 2 then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^ source.liquidsoap keyword.control.liquidsoap
>      x
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap variable.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      ["",".osb"]
#^^^^^^^ source.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  title = list.hd(default="",x)
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>  ext   = file.extension(leading_dot=false,list.nth(default="",x,1))
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
>  cmd = "rm -f $(output) && #{binary} -q -f best --no-playlist -o $(output) -- #{process.quote(arg)}"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                              ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                               ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                 ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                               ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                                    ^ source.liquidsoap string.quoted.double.liquidsoap
>  cmd = process.uri(timeout=timeout, extname=ext, cmd)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>
>  if title != "" then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap
#           ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap keyword.control.liquidsoap
>    ["annotate:title=#{string.quote(title)}:#{cmd}"]
#^^^^^ source.liquidsoap
#     ^ source.liquidsoap string.quoted.double.liquidsoap
#      ^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                       ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                   ^^ source.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    [cmd]
#^^^^^ source.liquidsoap
#     ^^^ source.liquidsoap variable.liquidsoap
#        ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("youtube-dl", protocol.youtube_dl,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>              doc="Resolve a request using youtube-dl.",
#^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>              syntax="youtube-dl:uri")
#^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the youtube-pl protocol.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># Syntax: youtube-pl:<ID>
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.youtube_pl(~rlog=_,~maxtime,arg)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                             ^ source.liquidsoap
#                              ^ source.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
>  binary = settings.protocol.youtube_dl.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>  delay = maxtime - time()
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>  cmd = "#{binary} -i -s --get-id --flat-playlist -- #{process.quote(arg)}"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                       ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                               ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                     ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
>  log(level=4,"Executing #{cmd}")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>  l = process.read.lines(timeout=delay,cmd)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^ source.liquidsoap variable.method.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  l = list.map(fun(s) -> "youtube-dl:https://www.youtube.com/watch?v="^s, l)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
>  l = string.concat(separator="\n", l) ^ "\n"
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^ source.liquidsoap
#                                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                                          ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
>  tmp = file.temp("youtube-pl","")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  file.write(data=l,tmp)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>  [tmp]
#^^^ source.liquidsoap
#   ^^^ source.liquidsoap variable.liquidsoap
#      ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("youtube-pl", protocol.youtube_pl,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>              doc="Resolve a request as a youtube playlist using youtube-dl. You typically want to use this as `playlist(\"youtube-pl:...\")`.",
#^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                                           ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                                                           ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>              temporary=true,syntax="youtube-pl:uri")
#^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
># Register tmp
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.tmp(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^ source.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap
#                                      ^^^ source.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap
>  [arg]
#^^^ source.liquidsoap
#   ^^^ source.liquidsoap variable.liquidsoap
#      ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("tmp",protocol.tmp,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Mark the given uri as temporary. Useful when chaining protocols",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             temporary=true,syntax="tmp:uri")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.ffmpeg = settings.make.protocol("FFmpeg")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                            ^ source.liquidsoap
#                             ^^ source.liquidsoap
#                               ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap keyword.other.liquidsoap
#                                        ^^^^ source.liquidsoap variable.method.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.ffmpeg.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^ source.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path to the ffmpeg binary",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "ffmpeg"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.ffmpeg.metadata = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^ source.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Should the protocol extract metadata",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  true
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.ffmpeg.replaygain = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                       ^ source.liquidsoap
#                                        ^^ source.liquidsoap
#                                          ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Should the protocol adjust ReplayGain",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  false
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Register ffmpeg
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.ffmpeg(~rlog,~maxtime,arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^^^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^ source.liquidsoap
>  ffmpeg   = settings.protocol.ffmpeg.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap
#                               ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>  metadata = settings.protocol.ffmpeg.metadata()
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap
#                               ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  replaygain = settings.protocol.ffmpeg.replaygain()
#^^ source.liquidsoap
#  ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                ^ source.liquidsoap keyword.other.liquidsoap
#                                 ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
>  def log(~level,s) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                 ^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap
>    rlog(s)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
>    log(label="protocol.ffmpeg",level=level,s)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def annotate(m) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap
>    def f(x) =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap
#            ^^ source.liquidsoap
>      let (key,value) = x
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap
#           ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#               ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^ source.liquidsoap
#                        ^ source.liquidsoap variable.liquidsoap
>      "#{key}=#{string.quote(value)}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#         ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>    m = string.concat(separator=",",list.map(f,m))
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    if string.length(m) > 0 then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "annotate:#{m}:"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      ""
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def parse_metadata(file) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
>    cmd = "#{ffmpeg} -i #{process.quote(file)} -f ffmetadata - 2>/dev/null | grep -v '^;'"
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                          ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap
>    delay = maxtime - time()
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>    log(level=4,"Executing #{cmd}")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                             ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>    lines = process.read.lines(timeout=delay,cmd)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^ source.liquidsoap variable.method.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
>    def f(cur,line) =
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap
>      m = r/=/.split(line)
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^ source.liquidsoap string.regexp.liquidsoap
#            ^ source.liquidsoap string.regexp.liquidsoap
#             ^ source.liquidsoap string.regexp.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>      if list.length(m) >= 2 then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap
#                        ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap keyword.control.liquidsoap
>        key = list.hd(default="",m)
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>        value = string.concat(separator="=",list.tl(m))
#^^^^^^^^ source.liquidsoap
#        ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>        (key,value)::cur
#^^^^^^^^^ source.liquidsoap
#         ^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#             ^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap keyword.operator.append.liquidsoap
#                     ^^^ source.liquidsoap variable.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        cur
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>    list.fold(f,[],lines)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def replaygain_filter(fname) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap
#                              ^^ source.liquidsoap
>    if replaygain then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap keyword.control.liquidsoap
>      gain = file.replaygain(fname)
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>      if null.defined(gain) then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>        "-af \"volume=#{null.get(gain)} dB\""
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#               ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                        ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                             ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                       ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                          ^^ source.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ""
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      ""
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def cue_points(m) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap
>    cue_in = float_of_string(default=0., list.assoc(default="0.","liq_cue_in",m))
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                             ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                  ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>    cue_out = float_of_string(default=0., list.assoc(default="","liq_cue_out",m))
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>
>    args =
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
>      if cue_in > 0. then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                   ^^ source.liquidsoap
#                     ^^^^ source.liquidsoap keyword.control.liquidsoap
>        "-ss #{cue_in}"
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#               ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ""
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    if cue_out > cue_in then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "#{args} -t #{cue_out-cue_in}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#         ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#              ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.operator.arithmetic.liquidsoap
#                            ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      args
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  def fades(r) =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap
>    m = request.metadata(r)
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>    fade_type = list.assoc(default="","liq_fade_type",m)
#^^^^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>    fade_in = list.assoc(default="","liq_fade_in",m)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>    cue_in = list.assoc(default="","liq_cue_in",m)
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    fade_out = list.assoc(default="","liq_fade_out",m)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>    cue_out = list.assoc(default="","liq_cue_out",m)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
>    curve =
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
>      if fade_type == "lin" then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ":curve=tri"
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
>      elsif fade_type == "sin" then
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ":curve=qsin"
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
>      elsif fade_type == "log" then
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ":curve=log"
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
>      elsif fade_type == "exp" then
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ":curve=exp"
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        ""
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap string.quoted.double.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>
>    args =
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
>      if fade_in != "" then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap keyword.control.liquidsoap
>        fade_in = float_of_string(default=0.,fade_in)
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>        start_time =
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^^ source.liquidsoap
>          if cue_in != "" then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^^ source.liquidsoap keyword.control.liquidsoap
>            float_of_string(default=0.,cue_in)
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>          else
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap keyword.control.liquidsoap
>            0.
#^^^^^^^^^^^^ source.liquidsoap
#            ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#             ^^ source.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>        if fade_in > 0. then
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                      ^^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>          ["afade=in:st=#{start_time}:d=#{fade_in}#{curve}"]
#^^^^^^^^^^^ source.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                          ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                          ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                  ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                           ^^ source.liquidsoap
>        else
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap keyword.control.liquidsoap
>          []
#^^^^^^^^^^^^^ source.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        []
#^^^^^^^^^^^ source.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    args =
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
>      if fade_out != "" then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap keyword.control.liquidsoap
>        fade_out = float_of_string(default=0.,fade_out)
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>        end_time =
#^^^^^^^^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^^ source.liquidsoap
>          if cue_out != "" then
#^^^^^^^^^^ source.liquidsoap
#          ^^ source.liquidsoap keyword.control.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^ source.liquidsoap keyword.control.liquidsoap
>            float_of_string(default=0.,cue_out)
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>          else
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap keyword.control.liquidsoap
>            null.get(request.duration(request.filename(r)))
#^^^^^^^^^^^^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>          end
#^^^^^^^^^^ source.liquidsoap
#          ^^^ source.liquidsoap keyword.control.liquidsoap
>        if fade_out > 0. then
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                       ^^ source.liquidsoap
#                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>          list.append(args,["afade=out:st=#{end_time-fade_out}:d=#{fade_out}#{curve}"])
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap keyword.operator.arithmetic.liquidsoap
#                                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                              ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>        else
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap keyword.control.liquidsoap
>          args
#^^^^^^^^^^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
>        end
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap keyword.control.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        args
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    if list.length(args) > 0 then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap keyword.control.liquidsoap
>      args = string.concat(separator=",",args)
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>      "-af #{args}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      ""
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>  r = request.create(arg)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>  delay = maxtime - time()
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>  if request.resolve(timeout=delay,r) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^ source.liquidsoap keyword.control.liquidsoap
>    filename = request.filename(r)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    m = request.metadata(r)
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>    m = if metadata then
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      list.append(m,parse_metadata(filename))
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                    ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      m
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>    annotate = annotate(m)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
>    request.destroy(r)
#^^^^ source.liquidsoap
#    ^^^^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
>
>    # Now parse the audio
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    wav = file.temp("liq-process", ".wav")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
>
>    cue_points = cue_points(request.metadata(r))
#^^^^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>    fades = fades(r)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
>    replaygain_filter = replaygain_filter(filename)
#^^^^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^^ source.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>
>    cmd = "#{ffmpeg} -y -i $(input) #{cue_points} #{fades} #{replaygain_filter} #{process.quote(wav)}"
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                      ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                  ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                           ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                             ^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                  ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                          ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                               ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                                ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                                    ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                                     ^ source.liquidsoap string.quoted.double.liquidsoap
>
>    uri = process.uri(extname="wav",uri=filename,cmd)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                 ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
>    wav_r = request.create(uri)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>    delay = maxtime - time()
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap keyword.operator.arithmetic.liquidsoap
#                     ^ source.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>    if request.resolve(timeout=delay,wav_r) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap
#                                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>      request.destroy(wav_r)
#^^^^^^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
>      ["#{annotate}tmp:#{wav}"]
#^^^^^^^ source.liquidsoap
#       ^ source.liquidsoap string.quoted.double.liquidsoap
#        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#          ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                   ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log(level=3,"Failed to resolve #{uri}")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>      []
#^^^^^^^^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    log(level=3,"Failed to resolve #{arg}")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>    []
#^^^^^^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("ffmpeg",protocol.ffmpeg,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Decode any file to wave using ffmpeg",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="ffmpeg:uri")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>
># Register stereo protocol which converts a file to stereo (currently decodes as
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># wav).
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.stereo(~rlog=_, ~maxtime=_, arg)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap
#                     ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^ source.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                        ^ source.liquidsoap
#                                         ^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
>  file = file.temp("liq-stereo", ".wav")
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                    ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
>  r = request.create(arg)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>  if not request.resolve(r) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>    log.info("Stereo: failed to resolve request #{arg}")
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap variable.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap
#        ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                  ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>    []
#^^^^^^^ source.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    # TODO: the following sometimes hangs, so we resolve twice...
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    # source.dump(%wav, file, source.stereo(once(request.queue(queue=[r]))))
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    source.dump(%wav, file, stereo(once(single(arg))))
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.encoder.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>    [file]
#^^^^^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^^ source.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true, temporary=true, "stereo", protocol.stereo, doc="Convert a file to stereo (currently decodes to wav).", syntax="stereo:<uri>")
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                 ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                         ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>
># Text2wave
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
>let settings.protocol.text2wave = settings.make.protocol("text2wave")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap
#                                           ^^^^ source.liquidsoap variable.method.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.text2wave.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^ source.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path to the text2wave binary",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "text2wave"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the text2wave: protocol using text2wave
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.text2wave(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^ source.liquidsoap
#                                            ^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap
>  binary = settings.protocol.text2wave.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>  [process.uri(extname="wav", "echo #{process.quote(arg)} | #{binary} -scale 1.9 > $(output)")]
#^^^ source.liquidsoap
#   ^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                     ^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                              ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true,"text2wave",protocol.text2wave,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                              ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Generate speech synthesis using text2wave. Result may be mono.",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="text2wave:Text to read")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>
># Pico2wave
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
>let settings.protocol.pico2wave = settings.make.protocol("pico2wave")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap
#                                           ^^^^ source.liquidsoap variable.method.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.pico2wave.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^ source.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path to the pico2wave binary",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "pico2wave"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.pico2wave.lang = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^ source.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>  description="pico2wave language. One of: `\"en-US\"`, `\"en-GB\"`, `\"es-ES\"`, `\"de-DE\"`, `\"fr-FR\"` or `\"it-IT\"`.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                             ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                       ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                         ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                      ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap constant.character.escape.liquidsoap
#                                                                                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "en-US"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.pico2wave(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                           ^ source.liquidsoap
#                                            ^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap
>  binary = settings.protocol.pico2wave.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>  lang = settings.protocol.pico2wave.lang()
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap
#                  ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap
#                           ^^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  [process.uri(extname="wav", "#{binary} -l #{lang} -w $(output) #{process.quote(arg)}")]
#^^^ source.liquidsoap
#   ^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                   ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                        ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true,"pico2wave",protocol.pico2wave,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                              ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Generate speech synthesis using pico2wave. Result may be mono.",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="pico2wave:Text to read")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>
># GTTS
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
>let settings.protocol.gtts = settings.make.protocol("gtts")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                          ^ source.liquidsoap
#                           ^^ source.liquidsoap
#                             ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap
#                                      ^^^^ source.liquidsoap variable.method.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.gtts.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path to the gtts binary",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "gtts-cli"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.gtts.lang = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Language to speak in.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "en"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.gtts.options = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^ source.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Command line options.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  ""
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the gtts: protocol using gtts
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.gtts(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap
#                                       ^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^ source.liquidsoap
>  binary = settings.protocol.gtts.path()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^^ source.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
>  lang = settings.protocol.gtts.lang()
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap keyword.other.liquidsoap
#                  ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap
#                           ^^^^ source.liquidsoap variable.method.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  options = settings.protocol.gtts.options()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap
#                              ^^^^ source.liquidsoap variable.method.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>  [process.uri(extname="mp3", "#{binary} --lang #{lang} #{options} -o $(output) #{process.quote(arg)}")]
#^^^ source.liquidsoap
#   ^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                  ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                                ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                       ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true,"gtts",protocol.gtts,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Generate speech synthesis using Google translate's text-to-speech API. This requires the `gtts-cli` binary.  Result may be mono.",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="gtts:Text to read")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
>
># Say
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>
># Register the legacy say: protocol
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def protocol.say(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^ source.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap
#                                      ^^^ source.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap
>  ["pico2wave:#{arg}", "gtts:#{arg}", "text2wave:#{arg}"]
#^^^ source.liquidsoap
#   ^ source.liquidsoap string.quoted.double.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                      ^ source.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                               ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                       ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                 ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                   ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true,"say",protocol.say,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                        ^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Generate speech synthesis using text2wave. Result is always stereo.",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="say:Text to read")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws = settings.make.protocol("AWS")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap
#                            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap keyword.other.liquidsoap
#                                     ^^^^ source.liquidsoap variable.method.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.profile = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^ source.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Use a specific profile from your credential file.",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  null()
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.endpoint = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^ source.liquidsoap
#                                     ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Alternative endpoint URL (useful for other S3 implementations).",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  null()
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.region = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^ source.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
>  description="AWS Region",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  null()
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.path = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                              ^ source.liquidsoap
#                               ^^ source.liquidsoap
#                                 ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Path to aws CLI binary",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "aws"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.polly = settings.make.protocol("polly")
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                               ^ source.liquidsoap
#                                ^^ source.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap
#                                           ^^^^ source.liquidsoap variable.method.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.polly.format = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^ source.liquidsoap
#                                         ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Output format",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "mp3"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
>let settings.protocol.aws.polly.voice = settings.make(
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^ source.liquidsoap
#                                        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>  description="Voice ID",
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>  "Joanna"
#^^ source.liquidsoap meta.function-call.liquidsoap
#  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#   ^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>)
#^ source.liquidsoap meta.function-call.liquidsoap
>
># Build a aws base call
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def aws_base() =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^ source.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap
>  aws = settings.protocol.aws.path()
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap
#                 ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap
#                          ^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
>
>  region = settings.protocol.aws.region()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^ source.liquidsoap variable.method.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
>  aws =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
>    if null.defined(region) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "#{aws} --region #{null.get(region)}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#         ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                              ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                          ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      aws
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  endpoint = settings.protocol.aws.endpoint()
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap
#                               ^^^ source.liquidsoap variable.method.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap
>
>  aws =
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
>    if null.defined(endpoint) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "#{aws} --endpoint-url #{process.quote(null.get(endpoint))}"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#         ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#             ^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                               ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                             ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                               ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      aws
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  profile = settings.protocol.aws.profile()
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap keyword.other.liquidsoap
#                     ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap
#                              ^^^ source.liquidsoap variable.method.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>
>  if null.defined(profile) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^ source.liquidsoap keyword.control.liquidsoap
>    "#{aws} --profile #{process.quote(null.get(profile))}"
#^^^^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#       ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                        ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                       ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                         ^ source.liquidsoap string.quoted.double.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    aws
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap variable.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Register the s3:// protocol
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def s3_protocol(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^ source.liquidsoap
#                ^ source.liquidsoap
#                 ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^ source.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap
#                                     ^^^ source.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^ source.liquidsoap
>  extname = file.extension(leading_dot=false,dir_sep="/",arg)
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                         ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
>  arg = process.quote("s3:#{arg}")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                       ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  [process.uri(extname=extname,"#{aws_base()} s3 cp #{arg} $(output)")]
#^^^ source.liquidsoap
#   ^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                      ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                      ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add("s3",s3_protocol,doc="Fetch files from s3 using the AWS CLI",
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="s3://uri")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
>
># Register the polly: protocol using AWS Polly
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># speech synthesis services. Syntax: polly:<text>
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def polly_protocol(~rlog=_, ~maxtime=_, text) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap
#                                        ^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^^ source.liquidsoap
>  aws = aws_base()
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
>
>  format = settings.protocol.aws.polly.format()
#^^ source.liquidsoap
#  ^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                   ^ source.liquidsoap keyword.other.liquidsoap
#                    ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap keyword.other.liquidsoap
#                             ^^^ source.liquidsoap variable.method.liquidsoap
#                                ^ source.liquidsoap keyword.other.liquidsoap
#                                 ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
>
>  extname =
#^^ source.liquidsoap
#  ^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
>    if format == "mp3" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "mp3"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^ source.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
>    elsif format == "ogg_vorbis" then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "ogg"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^ source.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      "wav"
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap string.quoted.double.liquidsoap
#       ^^^ source.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  aws = "#{aws} polly synthesize-speech --output-format #{format}"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                 ^ source.liquidsoap string.quoted.double.liquidsoap
>
>  voice_id = settings.protocol.aws.polly.voice()
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap keyword.other.liquidsoap
#                      ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap
#                               ^^^ source.liquidsoap variable.method.liquidsoap
#                                  ^ source.liquidsoap keyword.other.liquidsoap
#                                   ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>
>  cmd = "#{aws} --text #{process.quote(text)} --voice-id #{process.quote(voice_id)} $(output)"
#^^ source.liquidsoap
#  ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#           ^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#               ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                         ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                             ^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                         ^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                           ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                   ^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                        ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                         ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                 ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                                                  ^ source.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                                   ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                                                             ^ source.liquidsoap string.quoted.double.liquidsoap
>
>  [process.uri(extname=extname,cmd)]
#^^^ source.liquidsoap
#   ^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>protocol.add(static=true,"polly",polly_protocol,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="Generate speech synthesis using AWS polly service. \
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
>                  Result might be mono, needs aws binary in the path.",
#^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="polly:Text to read")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
>
># Protocol to synthesize audio.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def synth_protocol(~rlog=_, ~maxtime=_, text) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^ source.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap
#                                        ^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^^ source.liquidsoap
>  log.debug(label="synth", "Synthesizing request: #{text}")
#^^ source.liquidsoap
#  ^^^ source.liquidsoap variable.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>  args = r/,/.split(text)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap string.regexp.liquidsoap
#           ^ source.liquidsoap string.regexp.liquidsoap
#            ^ source.liquidsoap string.regexp.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>  args = list.map(r/=/.split, args)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
>  if list.exists(fun(l)-> list.length(l) != 2, args) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap
#                                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
>    []
#^^^^^^^ source.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    args = list.map(fun(l) -> (list.hd(default="",l), list.hd(default="",list.tl(l))), args)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap
#                           ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                             ^^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                       ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                           ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                         ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                              ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                      ^ source.liquidsoap
#                                                                                       ^^^^ source.liquidsoap variable.liquidsoap
#                                                                                           ^^ source.liquidsoap
>    shape = ref("sine")
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
>    duration = ref(10.)
#^^^^ source.liquidsoap
#    ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^^ source.liquidsoap
#              ^ source.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
>    frequency = ref(440.)
#^^^^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^^ source.liquidsoap
#               ^ source.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
>    def set(p)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
>      let (k,v) = p
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.other.function.declaration.pattern.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap entity.name.function.binding.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#             ^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^^^ source.liquidsoap
#                  ^ source.liquidsoap variable.liquidsoap
>      if k == "d" or k == "duration" then duration := float_of_string(v)
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap
#           ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap
#                       ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                                                     ^ source.liquidsoap
#                                                      ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
>      elsif k == "f" or k == "freq" or k == "frequency" then frequency := float_of_string(v)
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^ source.liquidsoap variable.liquidsoap
#                                        ^ source.liquidsoap
#                                         ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                           ^ source.liquidsoap
#                                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                                             ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                                      ^ source.liquidsoap string.quoted.double.liquidsoap
#                                                       ^ source.liquidsoap
#                                                        ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                                            ^ source.liquidsoap
#                                                             ^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                                                      ^ source.liquidsoap
#                                                                       ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                                                                         ^ source.liquidsoap
#                                                                          ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                           ^ source.liquidsoap meta.function-call.liquidsoap
>      elsif k == "s" or k == "shape" then shape := v
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap keyword.control.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                    ^ source.liquidsoap
#                     ^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                   ^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap
#                                     ^^^^ source.liquidsoap keyword.control.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^^^^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                                                  ^ source.liquidsoap
#                                                   ^ source.liquidsoap variable.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>    list.iter(set, args)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>    def synth(s)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#       ^ source.liquidsoap
#        ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#             ^ source.liquidsoap
#              ^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap
>      file = file.temp("liq-synth",".wav")
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^^^ source.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
>      log.info(label="synth", "Synthesizing #{shape()} in #{file}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                              ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                      ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>      source.dump(%wav, file, once(s))
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.encoder.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>      [file]
#^^^^^^^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>    if shape() == "sine" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap
#               ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                       ^ source.liquidsoap string.quoted.double.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap keyword.control.liquidsoap
>      synth(sine(duration=duration(), frequency()))
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>    elsif shape() == "saw" then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^ source.liquidsoap
#                           ^^^^ source.liquidsoap keyword.control.liquidsoap
>      synth(saw(duration=duration(), frequency()))
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    elsif shape() == "square" then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap
#                              ^^^^ source.liquidsoap keyword.control.liquidsoap
>      synth(square(duration=duration(), frequency()))
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
>    elsif shape() == "blank" then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap
#                  ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
#                      ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap keyword.control.liquidsoap
>      synth(blank(duration=duration()))
#^^^^^^ source.liquidsoap
#      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                           ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      []
#^^^^^^^^^ source.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>protocol.add(static=true, temporary=true, "synth", synth_protocol,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>doc="Syntesize audio. Parameters are optional.",
#^^^^ source.liquidsoap meta.function-call.liquidsoap
#    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>syntax="synth:shape=sine,frequency=440.,duration=10.")
#^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap
>
># File protocol
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def file_protocol(~rlog=_, ~maxtime=_, arg) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^ source.liquidsoap
#                   ^^^^ source.liquidsoap variable.parameter.liquidsoap
#                       ^ source.liquidsoap
#                        ^ source.liquidsoap variable.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                          ^ source.liquidsoap
#                           ^ source.liquidsoap
#                            ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^ source.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                      ^ source.liquidsoap
#                                       ^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^ source.liquidsoap
>  path = list.nth(default="", r/:/.split(arg), 1)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.regexp.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                         ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
>  segments = r/\//.split(path)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
#            ^ source.liquidsoap
#             ^^ source.liquidsoap string.regexp.liquidsoap
#               ^^ source.liquidsoap string.regexp.liquidsoap constant.character.escape.liquidsoap
#                 ^ source.liquidsoap string.regexp.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
>
>  segments =
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
>    if list.length(segments) > 3 and
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap keyword.operator.compare.liquidsoap
#                              ^ source.liquidsoap
#                               ^ source.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                ^ source.liquidsoap
#                                 ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
>       list.nth(default="foo",segments,0) == "" and
#^^^^^^^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap
#                                                ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
>       list.nth(default="foo",segments,1) == ""
#^^^^^^^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap constant.numeric.decimal.integer.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^ source.liquidsoap
#                                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                                            ^ source.liquidsoap
#                                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap string.quoted.double.liquidsoap
>    then
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      list.tl(list.tl(segments))
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                   ^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      segments
#^^^^^^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  [url.decode(string.concat(separator="/",segments))]
#^^^ source.liquidsoap
#   ^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>protocol.add(static=true, temporary=false, "file", file_protocol,
#^^^^^^^^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap meta.function-call.liquidsoap
#         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                         ^ source.liquidsoap meta.function-call.liquidsoap
#                          ^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap constant.language.boolean.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             doc="File protocol. Only local files are supported",
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
>             syntax="file:///path/to/file")
#^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
>