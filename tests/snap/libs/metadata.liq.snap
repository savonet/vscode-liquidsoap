>let metadata.getter = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^^ source.liquidsoap
>
># Create a getter from a metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @flag hidden
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param init Initial value.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param map Function to apply to the metadata value to obtain the new value.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param metadata Metadata on which the value should be updated.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param s Source containing the metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.getter.base(init, map, metadata, s)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^^ source.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                              ^ source.liquidsoap
#                               ^^^ source.liquidsoap variable.liquidsoap
#                                  ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                   ^ source.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap
#                                              ^ source.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap
>  x = ref(init)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>  def f(m)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#     ^ source.liquidsoap
#      ^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap
>    v = m[metadata]
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
#       ^ source.liquidsoap
#        ^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^^ source.liquidsoap
>    if v != "" then x := map(v) end
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^ source.liquidsoap variable.liquidsoap
#        ^ source.liquidsoap
#         ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#           ^ source.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap
#               ^^^^ source.liquidsoap keyword.control.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.set.liquidsoap
#                        ^ source.liquidsoap
#                         ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap
#                                ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>  s.on_metadata(f)
#^^ source.liquidsoap
#  ^ source.liquidsoap variable.liquidsoap
#   ^ source.liquidsoap meta.function-call.liquidsoap
#    ^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
>  ref.getter(x)
#^^ source.liquidsoap
#  ^^^ source.liquidsoap variable.liquidsoap
#     ^ source.liquidsoap meta.function-call.liquidsoap
#      ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Create a getter from a metadata: this is a string, whose value can be changed
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># with a metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param init Initial value.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param m Metadata on which the value should be updated.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param s Source containing the metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def replaces metadata.getter(init, m, s)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^ source.liquidsoap storage.modifier.liquidsoap
#             ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap
#                                   ^ source.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                     ^ source.liquidsoap
#                                      ^ source.liquidsoap variable.liquidsoap
#                                       ^ source.liquidsoap
>  metadata.getter.base(init, fun (v) -> v, m, s)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap
#           ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                                ^^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Create a float getter from a metadata: this is a float, whose value can be
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># changed with a metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param init Initial value.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param m Metadata on which the value should be updated.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param s Source containing the metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.getter.float(init, m, s)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                         ^ source.liquidsoap
#                          ^^^^ source.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap
#                                ^ source.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap
#                                   ^ source.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap
>  metadata.getter.base(init, float_of_string, m, s)
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap
#           ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract filename from metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.filename(m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                     ^ source.liquidsoap
#                      ^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap
>  m["filename"]
#^^ source.liquidsoap
#  ^ source.liquidsoap variable.liquidsoap
#   ^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#             ^ source.liquidsoap string.quoted.double.liquidsoap
#              ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract title from metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.title(m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
>  m["title"]
#^^ source.liquidsoap
#  ^ source.liquidsoap variable.liquidsoap
#   ^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract artist from metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.artist(m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
>  m["artist"]
#^^ source.liquidsoap
#  ^ source.liquidsoap variable.liquidsoap
#   ^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
#            ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract comment from metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.comment(m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                    ^ source.liquidsoap
#                     ^ source.liquidsoap variable.liquidsoap
#                      ^ source.liquidsoap
>  m["comment"]
#^^ source.liquidsoap
#  ^ source.liquidsoap variable.liquidsoap
#   ^ source.liquidsoap
#    ^ source.liquidsoap string.quoted.double.liquidsoap
#     ^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#            ^ source.liquidsoap string.quoted.double.liquidsoap
#             ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Extract cover from metadata. This function implements cover extraction
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># for the following formats: coverart (ogg), apic (flac, mp3) and pic (mp3).
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param m Metadata from which the cover should be extracted.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~coverart_mime Mime type to use for `"coverart"` metadata. Support disabled if `null`.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @method mime MIME type for the cover.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.cover(~coverart_mime=null(), m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                  ^ source.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                 ^ source.liquidsoap
#                                  ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap
#                                          ^ source.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap
>  fname = metadata.filename(m)
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
>  if list.assoc.mem("coverart", m) and null.defined(coverart_mime) then
#^^ source.liquidsoap
#  ^^ source.liquidsoap keyword.control.liquidsoap
#    ^ source.liquidsoap
#     ^^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap keyword.other.liquidsoap
#          ^^^^^ source.liquidsoap variable.method.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                     ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                      ^ source.liquidsoap
#                                       ^^^^ source.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                    ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                  ^ source.liquidsoap
#                                                                   ^^^^ source.liquidsoap keyword.control.liquidsoap
>    cover = list.assoc(default="", "coverart", m)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
>    string.base64.decode(cover).{mime=null.get(coverart_mime)}
#^^^^ source.liquidsoap
#    ^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap keyword.other.liquidsoap
#           ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap
#                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap
#                                 ^^^^ source.liquidsoap entity.name.method.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap
#                                           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap
>  elsif list.assoc.mem("metadata_block_picture", m) then
#^^ source.liquidsoap
#  ^^^^^ source.liquidsoap keyword.control.liquidsoap
#       ^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^^^^ source.liquidsoap variable.method.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                        ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^ source.liquidsoap keyword.control.liquidsoap
>    # See https://xiph.org/flac/format.html#metadata_block_picture
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    cover = list.assoc(default="", "metadata_block_picture", m)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                    ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap
>    cover = file.metadata.flac.cover.decode(cover)
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^ source.liquidsoap variable.liquidsoap
#                ^ source.liquidsoap keyword.other.liquidsoap
#                 ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                         ^ source.liquidsoap keyword.other.liquidsoap
#                          ^^^^ source.liquidsoap variable.method.liquidsoap
#                              ^ source.liquidsoap keyword.other.liquidsoap
#                               ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>    if not null.defined(cover) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log.info("Failed to read cover metadata for #{fname}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                  ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                    ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap
>      null()
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      null.get(cover)
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  else
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap keyword.control.liquidsoap
>    # Assume we have an mp3 file
#^^^^ source.liquidsoap
#    ^ source.liquidsoap comment.line.number-sign.liquidsoap
#     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>    m =
#^^^^ source.liquidsoap
#    ^ source.liquidsoap entity.name.function.binding.liquidsoap
#     ^^ source.liquidsoap
>      if list.assoc.mem("apic", m) or list.assoc.mem("pic", m) then
#^^^^^^ source.liquidsoap
#      ^^ source.liquidsoap keyword.control.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap keyword.other.liquidsoap
#              ^^^^^ source.liquidsoap variable.method.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^ source.liquidsoap keyword.operator.boolean.liquidsoap
#                                     ^ source.liquidsoap
#                                      ^^^^ source.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap keyword.other.liquidsoap
#                                           ^^^^^ source.liquidsoap variable.method.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                      ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap
#                                                              ^ source.liquidsoap
#                                                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>        m
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap variable.liquidsoap
>      else
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap keyword.control.liquidsoap
>        # Try the builtin tag reader because APIC tags are not read by default,
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap comment.line.number-sign.liquidsoap
#         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>        # e.g. with taglib
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap comment.line.number-sign.liquidsoap
#         ^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>        log.debug(label="metadata.cover", "APIC or PIC not found for #{fname}, trying builtin tag reader.")
#^^^^^^^^ source.liquidsoap
#        ^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                         ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                     ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                          ^ source.liquidsoap meta.function-call.liquidsoap
>        file.metadata.id3v2(fname)
#^^^^^^^^ source.liquidsoap
#        ^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
>      end
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap keyword.control.liquidsoap
>    pic = list.assoc(default="", "pic", m)
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                  ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
>    apic = list.assoc(default="", "apic", m)
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#        ^^ source.liquidsoap
#          ^ source.liquidsoap
#           ^^^^ source.liquidsoap variable.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                         ^ source.liquidsoap meta.function-call.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
>    if apic != "" then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap
#            ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#              ^ source.liquidsoap
#               ^ source.liquidsoap string.quoted.double.liquidsoap
#                ^ source.liquidsoap string.quoted.double.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log.debug(label="metadata.cover", "Found APIC for #{fname}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                       ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>      # TODO: we could use file type in order to select cover if there are many
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap comment.line.number-sign.liquidsoap
#       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>      string.apic.parse(apic)
#^^^^^^ source.liquidsoap
#      ^^^^^^ source.liquidsoap variable.liquidsoap
#            ^ source.liquidsoap keyword.other.liquidsoap
#             ^^^^ source.liquidsoap variable.method.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap
#                  ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
#                        ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
>    elsif pic != "" then
#^^^^ source.liquidsoap
#    ^^^^^ source.liquidsoap keyword.control.liquidsoap
#         ^ source.liquidsoap
#          ^^^ source.liquidsoap variable.liquidsoap
#             ^ source.liquidsoap
#              ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                ^ source.liquidsoap
#                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                  ^ source.liquidsoap string.quoted.double.liquidsoap
#                   ^ source.liquidsoap
#                    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log.debug(label="metadata.cover", "Found APIC for #{fname}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap
#                ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                       ^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                         ^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                        ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                          ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                                                ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                 ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>      # TODO: we could use file type in order to select cover if there are many
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap comment.line.number-sign.liquidsoap
#       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>      pic = string.pic.parse(pic)
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#         ^^ source.liquidsoap
#           ^ source.liquidsoap
#            ^^^^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap keyword.other.liquidsoap
#                   ^^^ source.liquidsoap variable.method.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap
#                             ^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
>      mime =
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#          ^^ source.liquidsoap
>        if pic.format == "JPG" then
#^^^^^^^^ source.liquidsoap
#        ^^ source.liquidsoap keyword.control.liquidsoap
#          ^ source.liquidsoap
#           ^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap
#               ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                        ^ source.liquidsoap
#                         ^ source.liquidsoap string.quoted.double.liquidsoap
#                          ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^ source.liquidsoap
#                               ^^^^ source.liquidsoap keyword.control.liquidsoap
>          "image/jpeg"
#^^^^^^^^^^ source.liquidsoap
#          ^ source.liquidsoap string.quoted.double.liquidsoap
#           ^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
>         elsif pic.format == "PNG" then
#^^^^^^^^^ source.liquidsoap
#         ^^^^^ source.liquidsoap keyword.control.liquidsoap
#              ^ source.liquidsoap
#               ^^^ source.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap keyword.other.liquidsoap
#                   ^^^^^^ source.liquidsoap variable.method.liquidsoap
#                         ^ source.liquidsoap
#                          ^^ source.liquidsoap keyword.operator.compare.liquidsoap
#                            ^ source.liquidsoap
#                             ^ source.liquidsoap string.quoted.double.liquidsoap
#                              ^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                 ^ source.liquidsoap string.quoted.double.liquidsoap
#                                  ^ source.liquidsoap
#                                   ^^^^ source.liquidsoap keyword.control.liquidsoap
>           "image/png"
#^^^^^^^^^^^ source.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                     ^ source.liquidsoap string.quoted.double.liquidsoap
>         else
#^^^^^^^^^ source.liquidsoap
#         ^^^^ source.liquidsoap keyword.control.liquidsoap
>           "application/octet-stream"
#^^^^^^^^^^^ source.liquidsoap
#           ^ source.liquidsoap string.quoted.double.liquidsoap
#            ^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#                                    ^ source.liquidsoap string.quoted.double.liquidsoap
>         end
#^^^^^^^^^ source.liquidsoap
#         ^^^ source.liquidsoap keyword.control.liquidsoap
>      pic.{mime=mime}
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^^ source.liquidsoap
#           ^^^^ source.liquidsoap entity.name.method.liquidsoap
#               ^ source.liquidsoap
#                ^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      log.info("No cover found for #{fname}.")
#^^^^^^ source.liquidsoap
#      ^^^ source.liquidsoap variable.liquidsoap
#         ^ source.liquidsoap meta.function-call.liquidsoap
#          ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                ^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                   ^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                     ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap variable.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap string.interpolation.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap
>      null()
#^^^^^^ source.liquidsoap
#      ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>  end
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.control.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Obtain cover-art for a file. `null` is returned in case there is no
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># such information.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param file File from which the cover should be obtained
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def file.cover(fname)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#              ^ source.liquidsoap
#               ^^^^^ source.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap
>  metadata.cover(file.metadata(fname))
#^^ source.liquidsoap
#  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#          ^ source.liquidsoap meta.function-call.liquidsoap
#           ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                      ^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                               ^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Remove cover metadata. This is mostly useful in order not to flood logs
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># with coverart when logging metadata.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.cover.remove(m)
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                         ^ source.liquidsoap
#                          ^ source.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap
>  list.assoc.filter(fun (k, _) -> k != "metadata_block_picture" and k != "apic" and k != "pic" and k != "cover", m)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap keyword.other.liquidsoap
#       ^^^^^ source.liquidsoap variable.method.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                       ^^ source.liquidsoap meta.function-call.liquidsoap
#                         ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap
#                               ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                    ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                        ^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.boolean.liquidsoap
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                          ^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.boolean.liquidsoap
#                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                      ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                         ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                          ^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                             ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                               ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.boolean.liquidsoap
#                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                   ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                     ^^ source.liquidsoap meta.function-call.liquidsoap keyword.operator.compare.liquidsoap
#                                                                                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                        ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                         ^^^^^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                              ^ source.liquidsoap meta.function-call.liquidsoap string.quoted.double.liquidsoap
#                                                                                                               ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                                                                 ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                                                                  ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Cleanup metadata for export. This is used to remove Liquidsoap's internal
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># metadata entries before sending them. List of exported metadata is set using
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># `settings.encoder.metadata.export.set`.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.export(m) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                   ^ source.liquidsoap
#                    ^ source.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap
#                      ^^ source.liquidsoap
>  exported_keys = settings.encoder.metadata.export()
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#               ^^ source.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^^^^ source.liquidsoap variable.liquidsoap
#                          ^ source.liquidsoap keyword.other.liquidsoap
#                           ^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                  ^ source.liquidsoap keyword.other.liquidsoap
#                                   ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>  list.assoc.filter((fun (k, (_:string)) -> list.mem(k, exported_keys)), m)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap keyword.other.liquidsoap
#       ^^^^^ source.liquidsoap variable.method.liquidsoap
#            ^ source.liquidsoap meta.function-call.liquidsoap
#             ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#                        ^^ source.liquidsoap meta.function-call.liquidsoap
#                          ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                            ^^ source.liquidsoap meta.function-call.liquidsoap
#                              ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#                                ^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.type-annotation.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^ source.liquidsoap meta.function-call.liquidsoap
#                                         ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                            ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                 ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                       ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                        ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                        ^ source.liquidsoap
#                                                                         ^ source.liquidsoap variable.liquidsoap
#                                                                          ^^ source.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
>let metadata.json = ()
#^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                 ^ source.liquidsoap
#                  ^^^^^ source.liquidsoap
>
># Export metadata as JSON object. Cover art, if found, is extracted using
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># `metadata.cover` and exported with key `"cover"` and exported using
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># `string.data_uri.encode`.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~coverart_mime Mime type to use for `"coverart"` metadata. Support disasbled if `null`.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~compact Output compact text.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @param ~json5 Use json5 extended spec.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.param.liquidsoap
#        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.json.stringify(~coverart_mime=null(), ~base64=true, ~compact=false, ~json5=false, m) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                           ^ source.liquidsoap
#                            ^ source.liquidsoap
#                             ^^^^^^^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                          ^ source.liquidsoap
#                                           ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                                 ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                  ^ source.liquidsoap
#                                                   ^ source.liquidsoap
#                                                    ^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                          ^ source.liquidsoap
#                                                           ^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                ^ source.liquidsoap
#                                                                 ^ source.liquidsoap
#                                                                  ^^^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                         ^ source.liquidsoap
#                                                                          ^^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                                               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                ^ source.liquidsoap
#                                                                                 ^ source.liquidsoap
#                                                                                  ^^^^^ source.liquidsoap variable.parameter.liquidsoap
#                                                                                       ^ source.liquidsoap
#                                                                                        ^^^^^ source.liquidsoap constant.language.boolean.liquidsoap
#                                                                                             ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                                              ^ source.liquidsoap
#                                                                                               ^ source.liquidsoap variable.liquidsoap
#                                                                                                ^ source.liquidsoap
#                                                                                                 ^^ source.liquidsoap
>  c = metadata.cover(coverart_mime=coverart_mime, m)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                                  ^ source.liquidsoap meta.function-call.liquidsoap
#                                   ^^^^^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
#                                                  ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                   ^ source.liquidsoap meta.function-call.liquidsoap
>  m = metadata.cover.remove(m)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap keyword.other.liquidsoap
#               ^^^^^ source.liquidsoap variable.method.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
#                     ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                             ^ source.liquidsoap meta.function-call.liquidsoap
>  m = metadata.export(m)
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap meta.function-call.liquidsoap
>
>  m =
#^^ source.liquidsoap
#  ^ source.liquidsoap entity.name.function.binding.liquidsoap
#   ^^ source.liquidsoap
>    if null.defined(c) then
#^^^^ source.liquidsoap
#    ^^ source.liquidsoap keyword.control.liquidsoap
#      ^ source.liquidsoap
#       ^^^^ source.liquidsoap variable.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                     ^ source.liquidsoap meta.function-call.liquidsoap
#                      ^ source.liquidsoap
#                       ^^^^ source.liquidsoap keyword.control.liquidsoap
>      c = null.get(c)
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap entity.name.function.binding.liquidsoap
#       ^^ source.liquidsoap
#         ^ source.liquidsoap
#          ^^^^ source.liquidsoap variable.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
#               ^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                    ^ source.liquidsoap meta.function-call.liquidsoap
>      [("cover", string.data_uri.encode(base64=base64, mime=c.mime, c)), ...m]
#^^^^^^^^ source.liquidsoap
#        ^ source.liquidsoap string.quoted.double.liquidsoap
#         ^^^^^ source.liquidsoap string.quoted.double.liquidsoap
#              ^ source.liquidsoap string.quoted.double.liquidsoap
#               ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                ^ source.liquidsoap
#                 ^^^^^^ source.liquidsoap variable.liquidsoap
#                       ^ source.liquidsoap keyword.other.liquidsoap
#                        ^^^^^^^^ source.liquidsoap variable.method.liquidsoap
#                                ^ source.liquidsoap meta.function-call.liquidsoap
#                                 ^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                       ^ source.liquidsoap meta.function-call.liquidsoap
#                                        ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap
#                                               ^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                     ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                      ^ source.liquidsoap meta.function-call.liquidsoap
#                                                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                                                           ^ source.liquidsoap meta.function-call.liquidsoap
#                                                            ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                             ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap
#                                                              ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.method.liquidsoap
#                                                                  ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                   ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                    ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                                     ^ source.liquidsoap meta.function-call.liquidsoap
#                                                                      ^ source.liquidsoap
#                                                                       ^ source.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                                                        ^ source.liquidsoap
#                                                                         ^^^ source.liquidsoap keyword.operator.spread.liquidsoap
#                                                                            ^ source.liquidsoap variable.liquidsoap
#                                                                             ^^ source.liquidsoap
>    else
#^^^^ source.liquidsoap
#    ^^^^ source.liquidsoap keyword.control.liquidsoap
>      m
#^^^^^^ source.liquidsoap
#      ^ source.liquidsoap variable.liquidsoap
>    end
#^^^^ source.liquidsoap
#    ^^^ source.liquidsoap keyword.control.liquidsoap
>
>  data = json()
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#      ^^ source.liquidsoap
#        ^ source.liquidsoap
#         ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#             ^ source.liquidsoap meta.function-call.liquidsoap
#              ^ source.liquidsoap meta.function-call.liquidsoap
>  list.iter(fun (v) -> data.add(fst(v),snd(v)), m)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#           ^ source.liquidsoap meta.function-call.liquidsoap
#            ^^^ source.liquidsoap meta.function-call.liquidsoap keyword.other.function.definition.anonymous.liquidsoap
#               ^^ source.liquidsoap meta.function-call.liquidsoap
#                 ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                  ^ source.liquidsoap meta.function-call.liquidsoap
#                   ^ source.liquidsoap meta.function-call.liquidsoap
#                    ^^ source.liquidsoap meta.function-call.liquidsoap keyword.control.function.declaration.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                            ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                               ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                   ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                     ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                      ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                       ^^^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                                          ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                           ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                             ^ source.liquidsoap meta.function-call.liquidsoap meta.function-call.liquidsoap
#                                              ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                               ^ source.liquidsoap meta.function-call.liquidsoap
#                                                ^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>  json.stringify(json5=json5,compact=compact,data)
#^^ source.liquidsoap
#  ^^^^ source.liquidsoap variable.liquidsoap
#      ^ source.liquidsoap meta.function-call.liquidsoap
#       ^^^^^^^^^ source.liquidsoap meta.function-call.liquidsoap entity.name.function.liquidsoap
#                ^ source.liquidsoap meta.function-call.liquidsoap
#                 ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                      ^ source.liquidsoap meta.function-call.liquidsoap
#                       ^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                             ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.language.arguments.named.liquidsoap
#                                    ^ source.liquidsoap meta.function-call.liquidsoap
#                                     ^^^^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                            ^ source.liquidsoap meta.function-call.liquidsoap keyword.other.liquidsoap punctuation.comma punctuation.separator.comma
#                                             ^^^^ source.liquidsoap meta.function-call.liquidsoap variable.liquidsoap
#                                                 ^ source.liquidsoap meta.function-call.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>
># Parse metadata from JSON object.
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
># @category Metadata
#^ source.liquidsoap comment.line.number-sign.liquidsoap
# ^ source.liquidsoap comment.line.number-sign.liquidsoap
#  ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap comment.doc.category.liquidsoap
#           ^^^^^^^^^ source.liquidsoap comment.line.number-sign.liquidsoap
>def metadata.json.parse(json_string) =
#^^^ source.liquidsoap keyword.other.function.definition.liquidsoap
#   ^ source.liquidsoap
#    ^^^^^^^^^^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                       ^ source.liquidsoap
#                        ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                   ^ source.liquidsoap
#                                    ^^ source.liquidsoap
>  let json.parse ( metadata_list : [(string * string)] as json.object ) = json_string
#^^ source.liquidsoap
#  ^^^ source.liquidsoap keyword.other.function.declaration.liquidsoap
#     ^ source.liquidsoap
#      ^^^^^^^^^^ source.liquidsoap entity.name.function.binding.liquidsoap
#                ^ source.liquidsoap
#                 ^^ source.liquidsoap
#                   ^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
#                                ^ source.liquidsoap
#                                 ^ source.liquidsoap meta.type-annotation.liquidsoap keyword.other.cast.liquidsoap
#                                  ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                   ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                    ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                     ^^^^^^^^^^^^^^^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                    ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                     ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                      ^^^^^^^^^^^^^^^^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                      ^ source.liquidsoap meta.type-annotation.liquidsoap
#                                                                       ^^^ source.liquidsoap
#                                                                          ^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>  metadata_list
#^^ source.liquidsoap
#  ^^^^^^^^^^^^^ source.liquidsoap variable.liquidsoap
>end
#^^^ source.liquidsoap keyword.other.function.end.liquidsoap
>